<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />

    <title>Basic folder</title>

    <meta name="author" content="Luis Guaiquirian" />

    <!-- NORMALIZE-->
    <link rel="stylesheet" href="styles/normalize.css" />

    <!--CSS-->
    <link rel="stylesheet" href="styles/main.css" />

    <!--PRINT-->
    <!-- <link rel="stylesheet" href="styles/print.css" media="print" /> -->

    <meta
      name="description"
      content="Luis Guaiquirian is a student web programmer, based in London Ontario, Canada."
    />

    <meta name="keywords" content="London Ontario" />

    <!-- Google Font - Oswald  -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap"
      rel="stylesheet"
    />

    <!-- Google Font - Open Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap"
      rel="stylesheet"
    />

    <!--FONT AWESOME-->
    <script
      src="https://kit.fontawesome.com/54c63f95c5.js"
      crossorigin="anonymous"
    ></script>
    <style>
      /* Oculta toda la página inicialmente */
      body {
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease;
      }

      /* Clase para mostrar contenido cuando está autenticado */
      body.authenticated {
        opacity: 1;
        visibility: visible;
      }
    </style>
  </head>
  <body>
    <div class="wrapp">
      <div class="menu">
        <div class="menu_header">
          <div class="header_logo">
            <a href="index.html">
              <img
                class="logo"
                src="assets/images/logos/logo.svg"
                alt="rbc place logo"
            /></a>
            <p>Event Services / Porter</p>
          </div>
        </div>
        <ul class="menu_ul">
          <li>
            <a href="faqs.html"><i class="fa-solid fa-question"></i> FAQs </a>
          </li>
        </ul>
      </div>
      <div class="content">
        <header class="content_header">
          <div class="content_header_title">
            <h1>Training & Resources</h1>
            <p>Find all the documentation we have prepared for you.</p>
          </div>
        </header>
        <main class="content_main">
          <section class="content_main_nav">
            <h2>Suggested tags</h2>
            <div class="tags_container">
              <button class="tag">Vacunning</button>
              <button class="tag">Ballrrom</button>
              <button class="tag">Studios</button>
              <button class="tag">Walls</button>
              <button class="tag">Vacunning</button>
              <button class="tag">Ballrrom</button>
              <button class="tag">Studios</button>
              <button class="tag">Walls</button>
              <button class="tag">Water stations</button>
              <button class="tag">Ballrrom</button>
              <button class="tag">First Aid</button>
              <button class="tag">Fire Alarms</button>
            </div>
            <div class="search_bar">
              <i class="fa-solid fa-magnifying-glass"></i>
              <input
                type="text"
                name="searchbar"
                class="searchbar"
                placeholder="Search by name, topic, etc"
              />
            </div>
          </section>
          <section class="content_main_cards">
            <article class="card">
              <a href="#">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-1.jpg"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">walls</span>
                  </div>
                  <h3 class="card_info_title">Placing items on walls.</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="#">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-2.jpg"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">fire</span>
                  </div>
                  <h3 class="card_info_title">Fire alarm.</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="#">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-3.jpg"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">linen</span>
                  </div>
                  <h3 class="card_info_title">Linen standards.</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="#">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-4.jpg"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">dance</span>
                  </div>
                  <h3 class="card_info_title">Dance floor</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="skirting.html">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-5.jpg"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">skirting</span>
                  </div>
                  <h3 class="card_info_title">Skirting chart.</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="waterStation.html">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-7.jpg"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">water</span>
                  </div>
                  <h3 class="card_info_title">Water stations.</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="#">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-8.png"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">skirting</span>
                  </div>
                  <h3 class="card_info_title">Skirting chart.</h3>
                </div>
              </a>
            </article>
            <article class="card">
              <a href="#">
                <figure class="card_figure">
                  <img
                    class="card_figure_img"
                    src="assets/images/example-9.png"
                    alt="thumbnails"
                  />
                </figure>
                <div class="card_info">
                  <div class="card_info_tags">
                    <span class="card_tag">water</span>
                  </div>
                  <h3 class="card_info_title">Water stations.</h3>
                </div>
              </a>
            </article>
          </section>
        </main>
      </div>
    </div>
    <footer class="footer"></footer>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA7svqbpLgrRp3zNBAiU_x4C3hjLtAIFMM",
        authDomain: "rbc-hub.firebaseapp.com",
        projectId: "rbc-hub",
        storageBucket: "rbc-hub.firebasestorage.app",
        messagingSenderId: "784121241722",
        appId: "1:784121241722:web:b",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      function checkSessionValidity() {
        onAuthStateChanged(
          auth,
          (user) => {
            if (!user) {
              window.location.href = "index.html";
              return;
            }

            // Verificar token de sesión
            user
              .getIdToken()
              .then((token) => {
                const storedSession = JSON.parse(
                  localStorage.getItem("sessionToken")
                );
                const currentTime = new Date().getTime();

                // Sesión caduca después de 30 minutos
                if (
                  !storedSession ||
                  currentTime - storedSession.timestamp > 30 * 60 * 1000
                ) {
                  auth.signOut();
                  window.location.href = "index.html";
                } else {
                  // Si la sesión es válida, muestra el contenido
                  document.body.classList.add("authenticated");
                }
              })
              .catch((error) => {
                console.error("Error al verificar token:", error);
                window.location.href = "index.html";
              });
          },
          (error) => {
            // Manejo de error de autenticación
            console.error("Error de autenticación:", error);
            window.location.href = "index.html";
          }
        );
      }

      // Botón de logout
      document.getElementById("logout")?.addEventListener("click", () => {
        // Limpiar sesión almacenada
        localStorage.removeItem("sessionToken");
        signOut(auth)
          .then(() => {
            window.location.href = "index.html";
          })
          .catch((error) => {
            console.error("Error al cerrar sesión:", error);
          });
      });

      // Verificar sesión al cargar la página
      checkSessionValidity();
    </script>
  </body>
</html>
